/*
 * viddy
 * v1.0.1
 * https://github.com/shuckster/viddy
 * License: MIT
 */
var $=Object.defineProperty,qe=Object.defineProperties,Ge=Object.getOwnPropertyDescriptor,Qe=Object.getOwnPropertyDescriptors,Ue=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var fe=(e,t,n)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,E=(e,t)=>{for(var n in t||(t={}))ee.call(t,n)&&fe(e,n,t[n]);if(V)for(var n of V(t))me.call(t,n)&&fe(e,n,t[n]);return e},A=(e,t)=>qe(e,Qe(t));var C=(e,t)=>{var n={};for(var r in e)ee.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&V)for(var r of V(e))t.indexOf(r)<0&&me.call(e,r)&&(n[r]=e[r]);return n};var Xe=(e,t)=>{for(var n in t)$(e,n,{get:t[n],enumerable:!0})},Ke=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ue(t))!ee.call(e,o)&&o!==n&&$(e,o,{get:()=>t[o],enumerable:!(r=Ge(t,o))||r.enumerable});return e};var Ye=e=>Ke($({},"__esModule",{value:!0}),e);var jt={};Xe(jt,{_viddyError:()=>ce,qsArray:()=>S,serialize:()=>wt,unserialize:()=>Tt,viddy:()=>Mt,viddyWell:()=>Nt});module.exports=Ye(jt);var Ze=Object.defineProperty;var et=(e,t)=>{for(var n in t)Ze(e,n,{get:t[n],enumerable:!0})},te={};et(te,{instanceOf:()=>ne,isArguments:()=>de,isArray:()=>nt,isDate:()=>rt,isFunction:()=>ot,isNumber:()=>it,isObject:()=>he,isPojo:()=>ct,isRegExp:()=>at,isString:()=>st});var pe=Object.prototype,tt=pe.toString,z=e=>t=>typeof t===e,ne=e=>t=>t instanceof e,{isArray:nt}=Array,de=e=>tt.call(e)==="[object Arguments]",rt=e=>ne(Date)(e)&&!isNaN(e),ot=z("function"),st=z("string"),it=e=>e===e&&z("number")(e),he=e=>e!==null&&z("object")(e),at=ne(RegExp),ct=e=>e===null||!he(e)||de(e)?!1:Object.getPrototypeOf(e)===pe,{isArray:l,isDate:At,isFunction:k,isNumber:J}=te,{isPojo:b,isRegExp:T,isString:c,instanceOf:Ct}=te;function p(e){return(...t)=>ut(...t)(e)}var ut=(...e)=>{let t;return n=>e.find(r=>{let o=r(n),{matched:s,value:a}=o||{};return[s,a].every(k)?s(n)&&(t=a(n),!0):o&&(t=o)})&&t},d=e=>t=>({matched:()=>!0,value:()=>k(e)?e(t):e}),i=e=>t=>n=>({matched:()=>w(e,n,r=>n=r),value:()=>k(t)?c(n)&&T(e)?t(...lt(n.match(e))):t(n):t}),lt=e=>{let{groups:t}=e;return t?[t,e]:[e]},w=(e,t,n)=>b(e)?Object.keys(e).every(r=>w(e[r],t==null?void 0:t[r],n)):l(e)?l(t)?e.length===t.length&&e.every((r,o)=>w(r,t==null?void 0:t[o],n)):e.some(r=>w(r,t,n)):k(e)?e(t,n):c(t)&&T(e)?e.test(t):e===t||[e,t].every(Number.isNaN),q=(...e)=>(t,n)=>e.length===0||(k(e[0])?e[0](t):w(e[0],t,n))?(n(t),!0):!1,F=e=>(t,n)=>!w(e,t,n),G=(...e)=>(t,n)=>e.flat().some(r=>w(r,t,n)),R=(...e)=>(t,n)=>e.flat().every(r=>w(r,t,n)),re=e=>e!==e||!e&&e!==0&&e!==!1||l(e)&&!e.length||b(e)&&!Object.keys(e).length,ye=e=>!re(e);var ge=e=>ft(t=>t.includes(e));var ft=e=>t=>(l(t)||c(t))&&e(t);function oe(e,t=new Map){return n=>t.has(n)?t.get(n):t.set(n,e(n)).get(n)}var Oe=(e,t)=>Object.entries(e).reduce((n,[r,o])=>(n[r]=t(o,r),n),{}),W=e=>e,M=()=>({valueOf:()=>{},toString:()=>"Nothing",map:()=>M(),chain:()=>M(),fork:e=>e(),orElse:e=>e(),ap:()=>M()});M.of=()=>M();var N=e=>({valueOf:()=>e,toString:()=>`Just(${e})`,map:t=>N(t(e)),chain:t=>t(e),fork:(t,n)=>n(e),orElse:()=>N(e),ap:t=>t.map(e)});N.of=e=>N(e);var mt=(e=t=>t!=null)=>{let t=n=>e(n)?N(n):M();return t.of=n=>t(n),t},ve=e=>{try{return N(e())}catch(t){return M()}},Rt=mt(),be=e=>()=>N(e);var se=e=>c(e)?(t,n)=>t[e]-n[e]:(t,n)=>t-n;function xe(e,t){let[n,r]=pt(e,t);return[(...s)=>(r(),n(...s)),r]}function pt(e,t){let n;return[(...s)=>{n=setTimeout(t,e,...s)},()=>clearTimeout(n)]}var we=e=>e instanceof HTMLElement,Te=e=>e.offsetParent!==null,S=e=>ve(()=>document.querySelectorAll(e)).map(Array.from).orElse(be([])).valueOf();function Se(e){let t=[],n=e.parentNode;for(;n&&n!==document;)t.push(n),n=n.parentNode;return t}function Pe(e){let{top:t,left:n,width:r,height:o}=e.getBoundingClientRect(),s=r/2,a=o/2,f=n+s,x=t+a;return{el:e,x:f,y:x,halfWidth:s,halfHeight:a}}function ke(e,t){let n=t.x-e.x,r=t.y-e.y,o=Ee(n,r,e.x,e.y,e.halfWidth,e.halfHeight),s=Ee(-n,-r,t.x,t.y,t.halfWidth,t.halfHeight);return Math.hypot(o.x-s.x,o.y-s.y)}function Ee(e,t,n,r,o,s){return Math.abs(t/e)<s/o?{x:n+(e>0?o:-o),y:r+t*o/Math.abs(e)}:{x:n+e*s/Math.abs(t),y:r+(t>0?s:-s)}}function Me(e){let t=e.toLowerCase();return n=>n.textContent.toLowerCase().includes(t)&&n.innerText.toLowerCase().includes(t)}var Ne=e=>t=>e.test(t.textContent)&&e.test(t.innerText);function Q(e){if(!(e instanceof Element))return;let t=[];for(;e.nodeType===Node.ELEMENT_NODE;){let n=e.nodeName.toLowerCase();if(e.id){t.unshift(`${n}#${e.id}`);break}let r=e,o=1;for(;r=r.previousElementSibling;)r.nodeName.toLowerCase()===n&&o++;let s=n;o>1&&(s+=":nth-of-type("+o+")"),t.unshift(s),e=e.parentNode}return t.join(" > ")}function ie(e){return p(e)(i({val:k})(t=>t.val()),i({tagName:"SELECT",multiple:!0})(({options:t})=>Array.from(t).reduce((n,r)=>r.selected?n.concat(r.value):n,[])),i({type:"checkbox",value:ye})(t=>t.checked?t.value:""),i({type:"checkbox"})(t=>t.checked?"checked":""),i({contenteditable:!0})(t=>t.innerHTML),d(t=>t.value))}function je(e,t){let n=t?new MutationObserver(o):new MutationObserver(r);return n.observe(document.body,{childList:!0,attributes:!0,subtree:!0}),()=>n.disconnect();function r(s){setTimeout(()=>e(s),1)}function o(s){let a=S(t);for(let f of s){let x=f.target;if(a.includes(x)){setTimeout(()=>e(),1);break}}}}var Le=(e,t)=>{let[n]=xe(32,t),r=S(e).map(o=>(o.addEventListener("change",n,{passive:!0}),()=>o.removeEventListener("change",n))).concat(()=>document.body.removeEventListener("click",n)).concat(()=>document.body.removeEventListener("keyup",n));return document.body.addEventListener("click",n,{passive:!0}),document.body.addEventListener("keyup",n,{passive:!0}),()=>r.forEach(o=>o())};var Ae="body *",Ce="input, select, textarea",dt=5,ht=R(l,re),y=G(c,T),yt=G(y,b),gt=R(b,{selector:F(c),pickParent:F(c)}),Ot=R(b,{pattern:y,selector:F(c)}),vt=R(b,{pattern:F(y),selector:F(c)}),ae="|<-REGEXP::FLAGS->|",bt=R(c,ge(ae)),xt=e=>[e.source,e.flags].join(ae),Et=e=>new RegExp(...e.split(ae)),wt=(...e)=>JSON.stringify(e,(t,n)=>p(n)(i(T)(xt),d(n))),Tt=e=>JSON.parse(e,(t,n)=>p(n)(i(bt)(Et),d(n)));function ce(e){return(t="could not find")=>n=>{let r=o=>`/${o.source}/${o.flags}`;return`viddy.${e} // ${t}: `+JSON.stringify(n,(o,s)=>s instanceof RegExp?r(s):s)}}var P=(...e)=>p(e)(i([y])(ue),i([y,b])(Pt),i([b])(D),d([]));function St(e){return(...t)=>p(t)(i([y])(([n])=>D([{selector:e,near:n}])),i([y,gt])(([n,r])=>D([A(E({},r),{selector:e,near:n})])),i([Ot])(o=>{var[s]=o,a=s,{pattern:n}=a,r=C(a,["pattern"]);return D([A(E({},r),{selector:e,near:n})])}),i([{selector:c}])(o=>{var[s]=o,a=s,{selector:n}=a,r=C(a,["selector"]);return D([A(E({},r),{selector:n})])}),d([]))}var X=St(Ce);function ue([e]){let t=p(e)(i(T)(Ne),d(Me)),n=S(Ae).filter(we).filter(Te).filter(t);return n.filter(r=>n.filter(s=>s!==r).every(s=>!r.contains(s)))}function Pt([e,t]){return U(ue([e]),t)}function D([e]){return p(e)(i({selector:c})(r=>{var o=r,{selector:t}=o,n=C(o,["selector"]);return U(S(t),n)}),i({pattern:y})(r=>{var o=r,{pattern:t}=o,n=C(o,["pattern"]);return U(ue([t]),n)}),d(()=>U(S(Ae),e)))}var kt=e=>E(E({},e),["near","above","below","leftOf","rightOf","containedBy"].reduce((t,n)=>A(E({},t),{[n]:p(e[n])(i(yt)(P),i(l)(r=>P(...r)),d(null))}),{}));function U(e,t={}){let H=kt(t),{near:n,containedBy:r,pickParent:o}=H,s=C(H,["near","containedBy","pickParent"]),a=Object.keys(s).length>0,f=oe(Pe),x=oe(Se),I=({depth:u},O,[h])=>u===h.depth,K=l(r)?u=>{let O=u.map(x),h=g=>j=>j.map((m,L)=>({contained:m.contains(g),depth:L,el:g})).filter(({contained:m})=>m)[0];return g=>O.map(h(g))[0]}:()=>u=>({depth:0,el:u}),_=a?u=>{let{above:O,below:h,leftOf:g,rightOf:j}=Oe(u,m=>l(m)?m.map(f):m);return m=>{let L=v=>v.filter(Je=>Je.el!==m),B=f(m),Be=!l(O)||L(O).every(v=>v.y>B.y),Ve=!l(h)||L(h).every(v=>v.y<B.y),$e=!l(g)||L(g).every(v=>v.x>B.x),ze=!l(j)||L(j).every(v=>v.x<B.x);return Be&&Ve&&$e&&ze}}:()=>()=>!0,Y=l(n)?u=>{let O=u.map(f);return h=>{let g=O.filter(m=>m.el!==h),j=f(h);return g.map(m=>({from:h,distance:ke(m,j)}))[0]}}:()=>u=>({distance:0,from:u}),Z=c(o)?u=>{let O=S(u);return h=>x(h).find(g=>O.includes(g))}:()=>W;return e.map(K(r)).filter(Boolean).sort(se("depth")).filter(I).map(({el:u})=>u).filter(_(s)).map(Y(n)).filter(Boolean).sort(se("distance")).map(({from:u})=>u).map(Z(o)).filter(Boolean)}function Fe(...e){return!!P(...e)[0]}function Re(...e){return P(...e).map(Q)}function Ie(...e){return X(...e).map(ie)}function le(...e){return P(...e).map(t=>t.innerText)}function We(e,...t){let n=p(t)(i(ht)(()=>[e]),i([l])(([r])=>r),i([y])(([r])=>({pattern:r})),i([vt])(([r])=>[A(E({},r),{pattern:e})]),d(()=>t));return le(...n).map(r=>p(e)(i(T)(o=>{var a;let s=(a=r.match(o))!=null?a:[void 0];return s.length>1||s.groups!==void 0?s:s[0]}),i(c)(r),d(null))).filter(G(c,l))}function De(e="baseWaitFor",t,...n){let r=p(n)(i([{timeoutInMs:q(J)}])(W),i([y,{timeoutInMs:q(J)}])(W),i([y,y,{timeoutInMs:q(J)}])(W),d(dt*1e3)),o=new Error(ce(e)(`timed out after ${r}ms looking for`)(n));return new Promise((s,a)=>{let f=H=>(s(H),_()),x=()=>(a(o),_()),I=t({done:f,args:n}),K=setTimeout(x,r),_=()=>{clearTimeout(K),Z(),Y()},Y=Le(Ce,I),Z=je(I);I()})}function _e(...e){return De("waitFor",t,...e);function t({args:n,done:r}){return()=>{let o=P(...n);o.length&&r(o.map(Q))}}}function He(e,...t){if(!t.length)throw new Error(ce("waitForValue")("no pattern specified")(t));return De("waitForValue",n,e,...t);function n({args:r,done:o}){return()=>{let s=X(...r.slice(1)).map(a=>({el:a,value:ie(a)})).filter(({value:a})=>p([e,a])(i([T,c])(([f])=>f.test(a)),i([c,c])(([f])=>f.toLowerCase()===a.toLowerCase()))).map(({el:a})=>a);s.length&&o(s.map(Q))}}}var Mt={for:(...e)=>P(...e)[0],forInput:(...e)=>X(...e)[0],selectorOf:(...e)=>Re(...e)[0],valueOf:(...e)=>Ie(...e)[0],waitFor:(...e)=>_e(...e).then(t=>t[0]),waitForValue:(...e)=>He(...e).then(t=>t[0]),innerText:(...e)=>le(...e)[0],matchText:(...e)=>We(...e)[0],hasContent:(...e)=>Fe(...e)},Nt={for:P,forInput:X,selectorOf:Re,valueOf:Ie,waitFor:_e,waitForValue:He,innerText:le,matchText:We,hasContent:Fe};0&&(module.exports={_viddyError,qsArray,serialize,unserialize,viddy,viddyWell});
