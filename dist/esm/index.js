/*
 * viddy
 * v1.4.1
 * https://github.com/shuckster/viddy
 * License: MIT
 */
var Jt=Object.create;var Oe=Object.defineProperty,Gt=Object.defineProperties,Xt=Object.getOwnPropertyDescriptor,Kt=Object.getOwnPropertyDescriptors,Yt=Object.getOwnPropertyNames,ae=Object.getOwnPropertySymbols,Zt=Object.getPrototypeOf,we=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var Be=(e,t,r)=>t in e?Oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,j=(e,t)=>{for(var r in t||(t={}))we.call(t,r)&&Be(e,r,t[r]);if(ae)for(var r of ae(t))He.call(t,r)&&Be(e,r,t[r]);return e},F=(e,t)=>Gt(e,Kt(t));var D=(e,t)=>{var r={};for(var n in e)we.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&ae)for(var n of ae(e))t.indexOf(n)<0&&He.call(e,n)&&(r[n]=e[n]);return r};var V=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var er=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Yt(t))!we.call(e,o)&&o!==r&&Oe(e,o,{get:()=>t[o],enumerable:!(n=Xt(t,o))||n.enumerable});return e};var tr=(e,t,r)=>(r=e!=null?Jt(Zt(e)):{},er(t||!e||!e.__esModule?Oe(r,"default",{value:e,enumerable:!0}):r,e));var Te=V((le,et)=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});var ce=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze=function(){function e(t,r){var n=[],o=!0,i=!1,a=void 0;try{for(var c=t[Symbol.iterator](),s;!(o=(s=c.next()).done)&&(n.push(s.value),!(r&&n.length===r));o=!0);}catch(u){i=!0,a=u}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}return n}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();le.default=hr;function hr(e,t){if(global.document)return!1;global.document=t.context||function(){for(var n=e;n.parent;)n=n.parent;return n}();var r=Object.getPrototypeOf(global.document);return Object.getOwnPropertyDescriptor(r,"childTags")||Object.defineProperty(r,"childTags",{enumerable:!0,get:function(){return this.children.filter(function(o){return o.type==="tag"||o.type==="script"||o.type==="style"})}}),Object.getOwnPropertyDescriptor(r,"attributes")||Object.defineProperty(r,"attributes",{enumerable:!0,get:function(){var o=this.attribs,i=Object.keys(o),a=i.reduce(function(c,s,u){return c[u]={name:s,value:o[s]},c},{});return Object.defineProperty(a,"length",{enumerable:!1,configurable:!1,value:i.length}),a}}),r.getAttribute||(r.getAttribute=function(n){return this.attribs[n]||null}),r.getElementsByTagName||(r.getElementsByTagName=function(n){var o=[];return B(this.childTags,function(i){(i.name===n||n==="*")&&o.push(i)}),o}),r.getElementsByClassName||(r.getElementsByClassName=function(n){var o=n.trim().replace(/\s+/g," ").split(" "),i=[];return B([this],function(a){var c=a.attribs.class;c&&o.every(function(s){return c.indexOf(s)>-1})&&i.push(a)}),i}),r.querySelectorAll||(r.querySelectorAll=function(n){var o=this;n=n.replace(/(>)(\S)/g,"$1 $2").trim();var i=gr(n),a=i.shift(),c=i.length;return a(this).filter(function(s){for(var u=0;u<c;){if(s=i[u](s,o),!s)return!1;u+=1}return!0})}),r.contains||(r.contains=function(n){var o=!1;return B([this],function(i,a){i===n&&(o=!0,a())}),o}),!0}function gr(e){return e.split(" ").reverse().map(function(t,r){var n=r===0,o=t.split(":"),i=Ze(o,2),a=i[0],c=i[1],s=null,u=null;if(function(){switch(!0){case/>/.test(a):u=function(l){return function(x){return x(l.parent)&&l.parent}};break;case/^\./.test(a):var b=a.substr(1).split(".");s=function(l){var x=l.attribs.class;return x&&b.every(function(E){return x.indexOf(E)>-1})},u=function(l,x){return n?l.getElementsByClassName(b.join(" ")):typeof l=="function"?l(s):ne(l,x,s)};break;case/^\[/.test(a):var m=a.replace(/\[|\]|"/g,"").split("="),w=Ze(m,2),v=w[0],d=w[1];s=function(l){var x=Object.keys(l.attribs).indexOf(v)>-1;return!!(x&&(!d||l.attribs[v]===d))},u=function(l,x){if(n){var E=function(){var I=[];return B([l],function(L){s(L)&&I.push(L)}),{v:I}}();if((typeof E=="undefined"?"undefined":ce(E))==="object")return E.v}return typeof l=="function"?l(s):ne(l,x,s)};break;case/^#/.test(a):var k=a.substr(1);s=function(l){return l.attribs.id===k},u=function(l,x){if(n){var E=function(){var I=[];return B([l],function(L,be){s(L)&&(I.push(L),be())}),{v:I}}();if((typeof E=="undefined"?"undefined":ce(E))==="object")return E.v}return typeof l=="function"?l(s):ne(l,x,s)};break;case/\*/.test(a):s=function(l){return!0},u=function(l,x){if(n){var E=function(){var I=[];return B([l],function(L){return I.push(L)}),{v:I}}();if((typeof E=="undefined"?"undefined":ce(E))==="object")return E.v}return typeof l=="function"?l(s):ne(l,x,s)};break;default:s=function(l){return l.name===a},u=function(l,x){if(n){var E=function(){var I=[];return B([l],function(L){s(L)&&I.push(L)}),{v:I}}();if((typeof E=="undefined"?"undefined":ce(E))==="object")return E.v}return typeof l=="function"?l(s):ne(l,x,s)}}}(),!c)return u;var p=c.match(/-(child|type)\((\d+)\)$/),g=p[1],O=parseInt(p[2],10)-1,y=function(m){if(m){var w=m.parent.childTags;g==="type"&&(w=w.filter(s));var v=w.findIndex(function(d){return d===m});if(v===O)return!0}return!1};return function(m){var w=u(m);return n?w.reduce(function(v,d){return y(d)&&v.push(d),v},[]):y(w)&&w}})}function B(e,t){e.forEach(function(r){var n=!0;t(r,function(){return n=!1}),r.childTags&&n&&B(r.childTags,t)})}function ne(e,t,r){for(;e.parent;){if(e=e.parent,r(e))return e;if(e===t)break}return null}et.exports=le.default});var de=V(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.convertNodeList=yr;fe.escapeValue=br;function yr(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[n];return r}function br(e){return e&&e.replace(/['"`\\/:\?&!#$%^()[\]{|}*+;,.<=>@~]/g,"\\$&").replace(/\n/g,"A")}});var lt=V((pe,ct)=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.default=Or;var ot=de(),tt={attribute:function(t){return["style","data-reactid","data-react-checksum"].indexOf(t)>-1}};function Or(e,t){var r=t.root,n=r===void 0?document:r,o=t.skip,i=o===void 0?null:o,a=t.priority,c=a===void 0?["id","class","href","src"]:a,s=t.ignore,u=s===void 0?{}:s,p=[],g=e,O=p.length,y=!1,b=i&&(Array.isArray(i)?i:[i]).map(function(v){return typeof v!="function"?function(d){return d===v}:v}),m=function(d){return i&&b.some(function(k){return k(d)})};for(Object.keys(u).forEach(function(v){v==="class"&&(y=!0);var d=u[v];typeof d!="function"&&(typeof d=="number"&&(d=d.toString()),typeof d=="string"&&(d=new RegExp((0,ot.escapeValue)(d).replace(/\\/g,"\\\\"))),typeof d=="boolean"&&(d=d?/(?:)/:/.^/),u[v]=function(k,h){return d.test(h)})}),y&&function(){var v=u.attribute;u.attribute=function(d,k,h){return u.class(k)||v&&v(d,k,h)}}();g!==n;){if(m(g)!==!0){if(rt(c,g,u,p,n)||nt(g,u,p,n))break;rt(c,g,u,p),p.length===O&&nt(g,u,p),p.length===O&&wr(c,g,u,p)}g=g.parentNode,O=p.length}if(g===n){var w=st(c,g,u);p.unshift(w)}return p.join(" ")}function rt(e,t,r,n){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:t.parentNode,i=it(e,t,r);if(i){var a=o.querySelectorAll(i);if(a.length===1)return n.unshift(i),!0}return!1}function it(e,t,r){for(var n=t.attributes,o=Object.keys(n).sort(function(m,w){var v=e.indexOf(n[m].name),d=e.indexOf(n[w].name);return d===-1?v===-1?0:-1:v-d}),i=0,a=o.length;i<a;i++){var c=o[i],s=n[c],u=s.name,p=(0,ot.escapeValue)(s.value),g=r[u]||r.attribute,O=tt[u]||tt.attribute;if(!ut(g,u,p,O)){var y="["+u+'="'+p+'"]';if(/\b\d/.test(p)===!1&&(u==="id"&&(y="#"+p),u==="class")){var b=p.trim().replace(/\s+/g,".");y="."+b}return y}}return null}function nt(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:e.parentNode,o=at(e,t);if(o){var i=n.getElementsByTagName(o);if(i.length===1)return r.unshift(o),!0}return!1}function at(e,t){var r=e.tagName.toLowerCase();return ut(t.tag,null,r)?null:r}function wr(e,t,r,n){for(var o=t.parentNode,i=o.childTags||o.children,a=0,c=i.length;a<c;a++){var s=i[a];if(s===t){var u=st(e,s,r);if(!u)return console.warn(`
          Element couldn't be matched through strict ignore pattern!
        `,s,r,u);var p="> "+u+":nth-child("+(a+1)+")";return n.unshift(p),!0}}return!1}function st(e,t,r){var n=it(e,t,r);return n||(n=at(t,r)),n}function ut(e,t,r,n){if(!r)return!0;var o=e||n;return o?o(t,r,n):!1}ct.exports=pe.default});var Ce=V((ve,ft)=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.default=_r;var xr=Te(),Sr=Er(xr),kr=de();function Er(e){return e&&e.__esModule?e:{default:e}}function _r(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Array.isArray(t)||(t=t.length?(0,kr.convertNodeList)(t):[t]),!t.length||t.some(function(g){return g.nodeType!==1}))throw new Error('Invalid input - to compare HTMLElements its necessary to provide a reference of the selected node(s)! (missing "elements")');var n=(0,Sr.default)(t[0],r),o=e.replace(/> /g,">").split(/\s+(?=(?:(?:[^"]*"){2})*[^"]*$)/);if(o.length<2)return me("",e,"",t);for(var i=[o.pop()];o.length>1;){var a=o.pop(),c=o.join(" "),s=i.join(" "),u=c+" "+s,p=document.querySelectorAll(u);p.length!==t.length&&i.unshift(me(c,a,s,t))}return i.unshift(o[0]),o=i,o[0]=me("",o[0],o.slice(1).join(" "),t),o[o.length-1]=me(o.slice(0,-1).join(" "),o[o.length-1],"",t),n&&delete global.document,o.join(" ").replace(/>/g,"> ").trim()}function me(e,t,r,n){if(e.length&&(e=e+" "),r.length&&(r=" "+r),/\[*\]/.test(t)){var o=t.replace(/=.*$/,"]"),i=""+e+o+r,a=document.querySelectorAll(i);if(te(a,n))t=o;else for(var c=document.querySelectorAll(""+e+o),s=function(){var h=c[u];if(n.some(function(x){return h.contains(x)})){var l=h.tagName.toLowerCase();return i=""+e+l+r,a=document.querySelectorAll(i),te(a,n)&&(t=l),"break"}},u=0,p=c.length;u<p;u++){var i,a,g=s();if(g==="break")break}}if(/>/.test(t)){var O=t.replace(/>/,""),i=""+e+O+r,a=document.querySelectorAll(i);te(a,n)&&(t=O)}if(/:nth-child/.test(t)){var y=t.replace(/nth-child/g,"nth-of-type"),i=""+e+y+r,a=document.querySelectorAll(i);te(a,n)&&(t=y)}if(/\.\S+\.\S+/.test(t)){for(var b=t.trim().split(".").slice(1).map(function(k){return"."+k}).sort(function(k,h){return k.length-h.length});b.length;){var m=t.replace(b.shift(),"").trim(),i=(""+e+m+r).trim();if(!i.length||i.charAt(0)===">"||i.charAt(i.length-1)===">")break;var a=document.querySelectorAll(i);te(a,n)&&(t=m)}if(b=t&&t.match(/\./g),b&&b.length>2)for(var w=document.querySelectorAll(""+e+t),v=function(){var h=w[u];if(n.some(function(x){return h.contains(x)})){var l=h.tagName.toLowerCase();return i=""+e+l+r,a=document.querySelectorAll(i),te(a,n)&&(t=l),"break"}},u=0,p=w.length;u<p;u++){var i,a,d=v();if(d==="break")break}}return t}function te(e,t){var r=e.length;return r===t.length&&t.every(function(n){for(var o=0;o<r;o++)if(e[o]===n)return!0;return!1})}ft.exports=ve.default});var Ne=V(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.getCommonAncestor=Ar;he.getCommonProperties=Mr;function Ar(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.root,n=r===void 0?document:r,o=[];e.forEach(function(g,O){for(var y=[];g!==n;)g=g.parentNode,y.unshift(g);o[O]=y}),o.sort(function(g,O){return g.length-O.length});for(var i=o.shift(),a=null,c=function(){var O=i[s],y=o.some(function(b){return!b.some(function(m){return m===O})});if(y)return"break";a=O},s=0,u=i.length;s<u;s++){var p=c();if(p==="break")break}return a}function Mr(e){var t={classes:[],attributes:{},tag:null};return e.forEach(function(r){var n=t.classes,o=t.attributes,i=t.tag;if(n!==void 0){var a=r.getAttribute("class");a?(a=a.trim().split(" "),n.length?(n=n.filter(function(s){return a.some(function(u){return u===s})}),n.length?t.classes=n:delete t.classes):t.classes=a):delete t.classes}if(o!==void 0&&function(){var s=r.attributes,u=Object.keys(s).reduce(function(O,y){var b=s[y],m=b.name;return b&&m!=="class"&&(O[m]=b.value),O},{}),p=Object.keys(u),g=Object.keys(o);p.length?g.length?(o=g.reduce(function(O,y){var b=o[y];return b===u[y]&&(O[y]=b),O},{}),Object.keys(o).length?t.attributes=o:delete t.attributes):t.attributes=u:delete t.attributes}(),i!==void 0){var c=r.tagName.toLowerCase();i?c!==i&&delete t.tag:t.tag=c}}),t}});var gt=V(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});var Tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};oe.getSingleSelector=je;oe.getMultiSelector=ht;oe.default=Pr;var Cr=Te(),pt=Ie(Cr),Nr=lt(),Ir=Ie(Nr),jr=Ce(),mt=Ie(jr),dt=de(),vt=Ne();function Ie(e){return e&&e.__esModule?e:{default:e}}function je(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.nodeType===3&&(e=e.parentNode),e.nodeType!==1)throw new Error('Invalid input - only HTMLElements or representations of them are supported! (not "'+(typeof e=="undefined"?"undefined":Tr(e))+'")');var r=(0,pt.default)(e,t),n=(0,Ir.default)(e,t),o=(0,mt.default)(n,e,t);return r&&delete global.document,o}function ht(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Array.isArray(e)||(e=(0,dt.convertNodeList)(e)),e.some(function(u){return u.nodeType!==1}))throw new Error("Invalid input - only an Array of HTMLElements or representations of them is supported!");var r=(0,pt.default)(e[0],t),n=(0,vt.getCommonAncestor)(e,t),o=je(n,t),i=Lr(e),a=i[0],c=(0,mt.default)(o+" "+a,e,t),s=(0,dt.convertNodeList)(document.querySelectorAll(c));return e.every(function(u){return s.some(function(p){return p===u})})?(r&&delete global.document,c):console.warn(`
      The selected elements can't be efficiently mapped.
      Its probably best to use multiple single selectors instead!
    `,e)}function Lr(e){var t=(0,vt.getCommonProperties)(e),r=t.classes,n=t.attributes,o=t.tag,i=[];if(o&&i.push(o),r){var a=r.map(function(s){return"."+s}).join("");i.push(a)}if(n){var c=Object.keys(n).reduce(function(s,u){return s.push("["+u+'="'+n[u]+'"]'),s},[]).join("");i.push(c)}return i.length,[i.join("")]}function Pr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.length&&!e.name?ht(e,t):je(e,t)}});var Ot=V(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.default=N.common=N.optimize=N.getMultiSelector=N.getSingleSelector=N.select=void 0;var Le=gt();Object.defineProperty(N,"getSingleSelector",{enumerable:!0,get:function(){return Le.getSingleSelector}});Object.defineProperty(N,"getMultiSelector",{enumerable:!0,get:function(){return Le.getMultiSelector}});var yt=bt(Le),qr=Ce(),Fr=bt(qr),Rr=Ne(),Dr=$r(Rr);function $r(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function bt(e){return e&&e.__esModule?e:{default:e}}N.select=yt.default;N.optimize=Fr.default;N.common=Dr;N.default=yt.default});var rr=Object.defineProperty;var nr=(e,t)=>{for(var r in t)rr(e,r,{get:t[r],enumerable:!0})},Se={};nr(Se,{instanceOf:()=>ke,isArguments:()=>Ve,isArray:()=>ir,isDate:()=>ar,isFunction:()=>sr,isNumber:()=>cr,isObject:()=>Ue,isPojo:()=>fr,isRegExp:()=>lr,isString:()=>ur});var ze=Object.prototype,or=ze.toString,se=e=>t=>typeof t===e,ke=e=>t=>t instanceof e,{isArray:ir}=Array,Ve=e=>or.call(e)==="[object Arguments]",ar=e=>ke(Date)(e)&&!isNaN(e),sr=se("function"),ur=se("string"),cr=e=>e===e&&se("number")(e),Ue=e=>e!==null&&se("object")(e),lr=ke(RegExp),fr=e=>e===null||!Ue(e)||Ve(e)?!1:Object.getPrototypeOf(e)===ze,{isArray:M,isDate:en,isFunction:Q,isNumber:W}=Se,{isPojo:C,isRegExp:$,isString:S,instanceOf:tn}=Se;function A(e){return(...t)=>Ee(...t)(e)}var Ee=(...e)=>{let t;return r=>e.find(n=>{let o=n(r),{matched:i,value:a}=o||{};return[i,a].every(Q)?i(r)&&(t=a(r),!0):o&&(t=o)})&&t},T=e=>t=>({matched:()=>!0,value:()=>Q(e)?e(t):e}),xe=e=>t=>r=>({matched:()=>U(e,r,n=>r=n),value:()=>Q(t)?S(r)&&$(e)?t(...dr(r.match(e))):t(r):t}),f=(...e)=>{if(e.length===1){let[t]=e;return xe(t)}if(e.length===2){let[t,r]=e;return xe(t)(r)}if(e.length>2){let t=e.slice(-1)[0],r=e.slice(0,-1);return xe(P(r))(t)}throw new Error("expected 1 or 2 arguments")},dr=e=>{let{groups:t}=e;return t?[t,e]:[e]},U=(e,t,r)=>C(e)?Object.keys(e).every(n=>U(e[n],t==null?void 0:t[n],r)):M(e)?M(t)&&e.length===t.length&&e.every((n,o)=>U(n,t==null?void 0:t[o],r)):Q(e)?e(t,r):S(t)&&$(e)?e.test(t):e===t||[e,t].every(Number.isNaN),Z=(...e)=>(t,r)=>e.length===0||(Q(e[0])?e[0](t):U(e[0],t,r))?(r(t),!0):!1,ee=e=>(t,r)=>!U(e,t,r),J=(...e)=>(t,r)=>e.flat().some(n=>U(n,t,r)),P=(...e)=>(t,r)=>e.flat().every(n=>U(n,t,r));var _e=e=>e!==e||!e&&e!==0&&e!==!1||M(e)&&!e.length||C(e)&&!Object.keys(e).length,Qe=e=>!_e(e);var Je=e=>pr(t=>t.includes(e));var pr=e=>(t,r)=>(M(t)||S(t))&&e(t,r);var Ae=e=>S(e)?(t,r)=>t[e]-r[e]:(t,r)=>t-r;function ue(e,t){let[r,n]=mr(e,t);return[(...i)=>(n(),r(...i)),n]}function mr(e,t){let r;return[(...i)=>{r=setTimeout(t,e,...i)},()=>clearTimeout(r)]}var Ge=(...e)=>t=>e.reduceRight((r,n)=>n(r),t);function Me(e,t=new Map){return r=>t.has(r)?t.get(r):t.set(r,e(r)).get(r)}var Xe=(e,t)=>Object.entries(e).reduce((r,[n,o])=>(r[n]=t(o,n),r),{}),K=e=>e,G=()=>({valueOf:()=>{},toString:()=>"Nothing",map:()=>G(),chain:()=>G(),fork:e=>e(),orElse:e=>e(),ap:()=>G()});G.of=()=>G();var X=e=>({valueOf:()=>e,toString:()=>`Just(${e})`,map:t=>X(t(e)),chain:t=>t(e),fork:(t,r)=>r(e),orElse:()=>X(e),ap:t=>t.map(e)});X.of=e=>X(e);var vr=(e=t=>t!=null)=>{let t=r=>e(r)?X(r):G();return t.of=r=>t(r),t},Ke=e=>{try{return X(e())}catch(t){return G()}},sn=vr(),Ye=e=>()=>X(e);var xt=tr(Ot(),1),St=e=>e instanceof HTMLElement,kt=e=>e.offsetParent!==null,H=e=>Ke(()=>document.querySelectorAll(e)).map(Array.from).orElse(Ye([])).valueOf();function Et(e){let t=[],r=e.parentNode;for(;r&&r!==document;)t.push(r),r=r.parentNode;return t}function _t(e){let{top:t,left:r,width:n,height:o}=e.getBoundingClientRect(),i=n/2,a=o/2,c=r+i,s=t+a;return{el:e,x:c,y:s,halfWidth:i,halfHeight:a}}function At(e,t){let r=t.x-e.x,n=t.y-e.y,o=wt(r,n,e.x,e.y,e.halfWidth,e.halfHeight),i=wt(-r,-n,t.x,t.y,t.halfWidth,t.halfHeight);return Math.hypot(o.x-i.x,o.y-i.y)}function wt(e,t,r,n,o,i){return Math.abs(t/e)<i/o?{x:r+(e>0?o:-o),y:n+t*o/Math.abs(e)}:{x:r+e*i/Math.abs(t),y:n+(t>0?i:-i)}}function Mt(e){let t=e.toLowerCase();return r=>r.textContent.toLowerCase().includes(t)&&r.innerText.toLowerCase().includes(t)}var Tt=e=>t=>e.test(t.textContent)&&e.test(t.innerText);function ie(e){if(e instanceof Element)return typeof global=="undefined"&&typeof window!="undefined"&&(global=window),(0,xt.select)(e)}function Pe(e){return A(e)(f({val:Q})(t=>t.val()),f({tagName:"SELECT",multiple:!0})(({options:t})=>Array.from(t).reduce((r,n)=>n.selected?r.concat(n.value):r,[])),f({type:"checkbox",value:Qe})(t=>t.checked?t.value:""),f({type:"checkbox"})(t=>t.checked?"checked":""),f({contenteditable:!0})(t=>t.innerHTML),T(t=>t.value))}function qe(e,t){let r=t?new MutationObserver(o):new MutationObserver(n);return r.observe(document.body,{childList:!0,attributes:!0,subtree:!0}),()=>r.disconnect();function n(i){setTimeout(()=>e(i),1)}function o(i){let a=H(t);for(let c of i){let s=c.target;if(a.some(u=>s.contains(u))){setTimeout(()=>e(),1);break}}}}var Ct=(e,t)=>{let[r]=ue(32,t),n=H(e).map(o=>(o.addEventListener("change",r,{passive:!0}),()=>o.removeEventListener("change",r))).concat(()=>document.body.removeEventListener("click",r)).concat(()=>document.body.removeEventListener("keyup",r));return document.body.addEventListener("click",r,{passive:!0}),document.body.addEventListener("keyup",r,{passive:!0}),()=>n.forEach(o=>o())};var It="body *",jt=["button","submit","reset","file"],Lt=jt.map(e=>`input:not([type=${e}])`).concat("select","textarea").join(", "),Wr=jt.map(e=>`input[type=${e}]`).concat("a","button").join(", "),Pt=5,Br=500,Hr=P(M,_e),_=J(S,$),zr=J(_,C),Vr=J(P(C,{pattern:_}),P(C,{selector:S})),qt=P(C,{pattern:_,selector:ee(S)}),Ft=P(C,{pattern:ee(_),selector:ee(S)}),Rt=P(C,{selector:ee(S),pickParent:ee(S)}),Re="|<-REGEXP::FLAGS->|",Ur=P(S,Je(Re)),Qr=e=>[e.source,e.flags].join(Re),Jr=e=>new RegExp(...e.split(Re)),kn=(...e)=>JSON.stringify(e,(t,r)=>A(r)(f($)(Qr),T(r))),En=e=>JSON.parse(e,(t,r)=>A(r)(f(Ur)(Jr),T(r))),re=class extends Error{constructor(t,r,{message:n="could not resolve query to any elements"}){let o=c=>`/${c.source}/${c.flags}`,i=(c,s)=>$(s)?o(s):s,a=JSON.stringify(r,i,2);super(`${n}

viddy.${t}(...${a})
`),this.name="ViddyError"}};var z=(...e)=>A(e)(f([_])(Fe),f([_,C])(([t,r])=>q([j({pattern:t},r)])),f([C])(q),T([]));function Gr(e){return(...t)=>A(t)(f([_])(([r])=>q([{selector:e,near:r}])),f([_,Rt])(([r,n])=>q([{selector:e,near:F(j({},n),{pattern:r})}])),f([qt])(o=>{var[i]=o,a=i,{pattern:r}=a,n=D(a,["pattern"]);return q([{selector:e,near:F(j({},n),{pattern:r})}])}),f([{selector:S}])(o=>{var[i]=o,a=i,{selector:r}=a,n=D(a,["selector"]);return q([F(j({},n),{selector:r})])}),T([]))}function Xr(e){return(...t)=>Ge(r=>r.filter(Ee(f(J(H(e)))(!0))))(A(t)(f([_])(([r])=>q([{containedBy:{selector:e},pattern:r}])),f([_,Rt])(([r,n])=>q([F(j({},n),{containedBy:{selector:e},pattern:r})])),f([qt])(o=>{var[i]=o,a=i,{pattern:r}=a,n=D(a,["pattern"]);return q([F(j({},n),{containedBy:{selector:e},pattern:r})])}),f([Ft])(([r])=>q([F(j({},r),{containedBy:{selector:e}})])),f([{selector:S}])(o=>{var[i]=o,a=i,{selector:r}=a,n=D(a,["selector"]);return q([F(j({},n),{selector:r})])}),T(q([{selector:e}]))))}var ye=Gr(Lt),De=Xr(Wr);function Fe([e,t=It]){let r=A(e)(f($)(Tt),T(Mt)),n=H(t).filter(St).filter(kt).filter(r);return n.filter(o=>n.filter(a=>a!==o).every(a=>!o.contains(a)))}function q([e]){return A(e)(f({pattern:_,selector:S})(o=>{var i=o,{pattern:t,selector:r}=i,n=D(i,["pattern","selector"]);return ge(Fe([t,r]),n)}),f({pattern:_})(n=>{var o=n,{pattern:t}=o,r=D(o,["pattern"]);return ge(Fe([t]),r)}),f({selector:S})(n=>{var o=n,{selector:t}=o,r=D(o,["selector"]);return ge(H(t),r)}),T(()=>ge(H(It),e)))}var Kr=e=>j(j({},e),["near","above","below","leftOf","rightOf","containedBy"].reduce((t,r)=>F(j({},t),{[r]:A(e[r])(f(zr)(z),f(M)(n=>z(...n)),T(null))}),{}));function ge(e,t={}){let b=Kr(t),{near:r,containedBy:n,pickParent:o}=b,i=D(b,["near","containedBy","pickParent"]),a=Object.keys(i).length>0,c=Me(_t),s=Me(Et),u=({depth:m},w,[v])=>m===v.depth,p=M(n)?m=>{let w=m.map(s),v=d=>k=>k.map((h,l)=>({contained:h.contains(d),depth:l,el:d})).filter(({contained:h})=>h)[0];return d=>w.map(v(d))[0]}:()=>m=>({depth:0,el:m}),g=a?m=>{let{above:w,below:v,leftOf:d,rightOf:k}=Xe(m,h=>M(h)?h.map(c):h);return h=>{let l=R=>R.filter(Qt=>Qt.el!==h),x=c(h),E=!M(w)||l(w).every(R=>R.y>x.y),I=!M(v)||l(v).every(R=>R.y<x.y),L=!M(d)||l(d).every(R=>R.x>x.x),be=!M(k)||l(k).every(R=>R.x<x.x);return E&&I&&L&&be}}:()=>()=>!0,O=M(r)?m=>{let w=m.map(c);return v=>{let d=w.filter(h=>h.el!==v),k=c(v);return d.map(h=>({from:v,distance:At(h,k)}))[0]}}:()=>m=>({distance:0,from:m}),y=S(o)?m=>{let w=H(m);return v=>s(v).find(d=>w.includes(d))}:()=>K;return e.map(p(n)).filter(Boolean).sort(Ae("depth")).filter(u).map(({el:m})=>m).filter(g(i)).map(O(r)).filter(Boolean).sort(Ae("distance")).map(({from:m})=>m).map(y(o)).filter(Boolean)}function Dt(...e){return!!z(...e)[0]}function $t(...e){return z(...e).map(ie)}function Wt(...e){return ye(...e).map(Pe)}function $e(...e){return z(...e).map(t=>t.innerText)}function Bt(e,...t){let r=A(t)(f(Hr)(()=>[e]),f([M])(([n])=>n),f([_])(([n])=>({pattern:n})),f([Ft])(([n])=>[F(j({},n),{pattern:e})]),T(()=>t));return $e(...r).map(n=>A(e)(f($)(o=>{var a;let i=(a=n.match(o))!=null?a:[void 0];return i.length>1||i.groups!==void 0?i:i[0]}),f(S)(n),T(null))).filter(J(S,M))}function We(e="baseWaitFor",t,...r){let n=A(r)(f([{timeoutInMs:Z(W)}])(K),f([_,{timeoutInMs:Z(W)}])(K),f([_,_,{timeoutInMs:Z(W)}])(K),T(Pt*1e3)),o=new re(e,r,{message:`timed out after ${n}ms trying to resolve query`});return new Promise((i,a)=>{let c=b=>(i(b),g()),s=()=>(a(o),g()),u=t({done:c,args:r}),p=setTimeout(s,n),g=()=>{clearTimeout(p),y(),O()},O=Ct(Lt,u),y=qe(u);u()})}function Ht(...e){return We("waitFor",t,...e);function t({args:r,done:n}){return()=>{let o=z(...r);o.length&&n(o.map(ie))}}}function zt(...e){return We("waitForCta",t,...e);function t({args:r,done:n}){return()=>{let o=De(...r);o.length&&n(o.map(ie))}}}function Vt(e,...t){if(!t.length)throw new re("waitForValue",t,{message:"no query specified"});return We("waitForValue",r,e,...t);function r({args:n,done:o}){return()=>{let i=ye(...n.slice(1)).map(a=>({el:a,value:Pe(a)})).filter(({value:a})=>A([e,a])(f([$,S])(([c])=>c.test(a)),f([S,S])(([c])=>c.toLowerCase()===a.toLowerCase()))).map(({el:a})=>a);i.length&&o(i.map(ie))}}}var Nt=J(P(C,{withinMs:W}),P(C,{timeoutInMs:W}),P(C,{withinMs:W,timeoutInMs:W}));function Ut(...e){let t=A(e)(f([Z(Nt)])(K),f([_,Z(Nt)])(K),T({})),{withinMs:r=Br}=t,{timeoutInMs:n=Pt*1e3}=t,o=Math.max(n,r+16),i=new re("waitForIdle",e,{message:`timed out after ${o}ms waiting for DOM idle`}),a=A(e)(f([_])(!0),f([Vr])(!0),f([_,C])(!0),T(!1)),c=a&&Yr.selectorOf(...e);if(a&&!c)throw new re("waitForIdle",e,{message:"need resolvable query to monitor for DOM idle, or omit query to monitor all DOM changes"});return new Promise((s,u)=>{let p=()=>(s(),m()),O=setTimeout(()=>(u(i),m()),o),[y,b]=ue(r,p),m=()=>{clearTimeout(O),b(),w()},w=qe(y,c);y()})}function Y(e){return(...t)=>e(...t)[0]}var Yr={for:Y(z),forCta:Y(De),forInput:Y(ye),selectorOf:Y($t),valueOf:Y(Wt),waitFor:(...e)=>Ht(...e).then(t=>t[0]),waitForCta:(...e)=>zt(...e).then(t=>t[0]),waitForValue:(...e)=>Vt(...e).then(t=>t[0]),waitForIdle:Ut,innerText:Y($e),matchText:Y(Bt),hasContent:Dt},_n={for:z,forInput:ye,forCta:De,selectorOf:$t,valueOf:Wt,waitFor:Ht,waitForCta:zt,waitForValue:Vt,waitForIdle:Ut,innerText:$e,matchText:Bt,hasContent:Dt};export{re as ViddyError,H as qsArray,kn as serialize,En as unserialize,Yr as viddy,_n as viddyWell};
