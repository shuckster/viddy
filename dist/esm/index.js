/*
 * viddy
 * v1.2.2
 * https://github.com/shuckster/viddy
 * License: MIT
 */
var ot=Object.defineProperty,rt=Object.defineProperties;var st=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var he=(e,t,n)=>t in e?ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,v=(e,t)=>{for(var n in t||(t={}))ye.call(t,n)&&he(e,n,t[n]);if(K)for(var n of K(t))Oe.call(t,n)&&he(e,n,t[n]);return e},M=(e,t)=>rt(e,st(t));var C=(e,t)=>{var n={};for(var o in e)ye.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&K)for(var o of K(e))t.indexOf(o)<0&&Oe.call(e,o)&&(n[o]=e[o]);return n};var it=Object.defineProperty;var at=(e,t)=>{for(var n in t)it(e,n,{get:t[n],enumerable:!0})},ne={};at(ne,{instanceOf:()=>oe,isArguments:()=>ve,isArray:()=>ut,isDate:()=>lt,isFunction:()=>mt,isNumber:()=>pt,isObject:()=>be,isPojo:()=>ht,isRegExp:()=>dt,isString:()=>ft});var ge=Object.prototype,ct=ge.toString,Y=e=>t=>typeof t===e,oe=e=>t=>t instanceof e,{isArray:ut}=Array,ve=e=>ct.call(e)==="[object Arguments]",lt=e=>oe(Date)(e)&&!isNaN(e),mt=Y("function"),ft=Y("string"),pt=e=>e===e&&Y("number")(e),be=e=>e!==null&&Y("object")(e),dt=oe(RegExp),ht=e=>e===null||!be(e)||ve(e)?!1:Object.getPrototypeOf(e)===ge,{isArray:p,isDate:Lt,isFunction:j,isNumber:F}=ne,{isPojo:h,isRegExp:I,isString:c,instanceOf:At}=ne;function f(e){return(...t)=>re(...t)(e)}var re=(...e)=>{let t;return n=>e.find(o=>{let r=o(n),{matched:s,value:a}=r||{};return[s,a].every(j)?s(n)&&(t=a(n),!0):r&&(t=r)})&&t},d=e=>t=>({matched:()=>!0,value:()=>j(e)?e(t):e}),i=e=>t=>n=>({matched:()=>P(e,n,o=>n=o),value:()=>j(t)?c(n)&&I(e)?t(...yt(n.match(e))):t(n):t}),yt=e=>{let{groups:t}=e;return t?[t,e]:[e]},P=(e,t,n)=>h(e)?Object.keys(e).every(o=>P(e[o],t==null?void 0:t[o],n)):p(e)?p(t)?e.length===t.length&&e.every((o,r)=>P(o,t==null?void 0:t[r],n)):e.some(o=>P(o,t,n)):j(e)?e(t,n):c(t)&&I(e)?e.test(t):e===t||[e,t].every(Number.isNaN),q=(...e)=>(t,n)=>e.length===0||(j(e[0])?e[0](t):P(e[0],t,n))?(n(t),!0):!1,V=e=>(t,n)=>!P(e,t,n),L=(...e)=>(t,n)=>e.flat().some(o=>P(o,t,n)),w=(...e)=>(t,n)=>e.flat().every(o=>P(o,t,n)),se=e=>e!==e||!e&&e!==0&&e!==!1||p(e)&&!e.length||h(e)&&!Object.keys(e).length,xe=e=>!se(e);var we=e=>Ot(t=>t.includes(e));var Ot=e=>t=>(p(t)||c(t))&&e(t);var ie=e=>c(e)?(t,n)=>t[e]-n[e]:(t,n)=>t-n;function Z(e,t){let[n,o]=gt(e,t);return[(...s)=>(o(),n(...s)),o]}function gt(e,t){let n;return[(...s)=>{n=setTimeout(t,e,...s)},()=>clearTimeout(n)]}var Ee=(...e)=>t=>e.reduceRight((n,o)=>o(n),t);function ae(e,t=new Map){return n=>t.has(n)?t.get(n):t.set(n,e(n)).get(n)}var Me=(e,t)=>Object.entries(e).reduce((n,[o,r])=>(n[o]=t(r,o),n),{}),R=e=>e,A=()=>({valueOf:()=>{},toString:()=>"Nothing",map:()=>A(),chain:()=>A(),fork:e=>e(),orElse:e=>e(),ap:()=>A()});A.of=()=>A();var D=e=>({valueOf:()=>e,toString:()=>`Just(${e})`,map:t=>D(t(e)),chain:t=>t(e),fork:(t,n)=>n(e),orElse:()=>D(e),ap:t=>t.map(e)});D.of=e=>D(e);var vt=(e=t=>t!=null)=>{let t=n=>e(n)?D(n):A();return t.of=n=>t(n),t},Te=e=>{try{return D(e())}catch(t){return A()}},Bt=vt(),Se=e=>()=>D(e);var Ce=e=>e instanceof HTMLElement,Pe=e=>e.offsetParent!==null,N=e=>Te(()=>document.querySelectorAll(e)).map(Array.from).orElse(Se([])).valueOf();function Fe(e){let t=[],n=e.parentNode;for(;n&&n!==document;)t.push(n),n=n.parentNode;return t}function Ne(e){let{top:t,left:n,width:o,height:r}=e.getBoundingClientRect(),s=o/2,a=r/2,u=n+s,y=t+a;return{el:e,x:u,y,halfWidth:s,halfHeight:a}}function ke(e,t){let n=t.x-e.x,o=t.y-e.y,r=Ie(n,o,e.x,e.y,e.halfWidth,e.halfHeight),s=Ie(-n,-o,t.x,t.y,t.halfWidth,t.halfHeight);return Math.hypot(r.x-s.x,r.y-s.y)}function Ie(e,t,n,o,r,s){return Math.abs(t/e)<s/r?{x:n+(e>0?r:-r),y:o+t*r/Math.abs(e)}:{x:n+e*s/Math.abs(t),y:o+(t>0?s:-s)}}function je(e){let t=e.toLowerCase();return n=>n.textContent.toLowerCase().includes(t)&&n.innerText.toLowerCase().includes(t)}var Le=e=>t=>e.test(t.textContent)&&e.test(t.innerText);function G(e){if(!(e instanceof Element))return;let t=[];for(;e.nodeType===Node.ELEMENT_NODE;){let n=e.nodeName.toLowerCase();if(e.id){t.unshift(`${n}#${e.id}`);break}let o=e,r=1;for(;o=o.previousElementSibling;)o.nodeName.toLowerCase()===n&&r++;let s=n;r>1&&(s+=":nth-of-type("+r+")"),t.unshift(s),e=e.parentNode}return t.join(" > ")}function ce(e){return f(e)(i({val:j})(t=>t.val()),i({tagName:"SELECT",multiple:!0})(({options:t})=>Array.from(t).reduce((n,o)=>o.selected?n.concat(o.value):n,[])),i({type:"checkbox",value:xe})(t=>t.checked?t.value:""),i({type:"checkbox"})(t=>t.checked?"checked":""),i({contenteditable:!0})(t=>t.innerHTML),d(t=>t.value))}function ue(e,t){let n=t?new MutationObserver(r):new MutationObserver(o);return n.observe(document.body,{childList:!0,attributes:!0,subtree:!0}),()=>n.disconnect();function o(s){setTimeout(()=>e(s),1)}function r(s){let a=N(t);for(let u of s){let y=u.target;if(a.some(T=>y.contains(T))){setTimeout(()=>e(),1);break}}}}var Ae=(e,t)=>{let[n]=Z(32,t),o=N(e).map(r=>(r.addEventListener("change",n,{passive:!0}),()=>r.removeEventListener("change",n))).concat(()=>document.body.removeEventListener("click",n)).concat(()=>document.body.removeEventListener("keyup",n));return document.body.addEventListener("click",n,{passive:!0}),document.body.addEventListener("keyup",n,{passive:!0}),()=>o.forEach(r=>r())};var Re="body *",We=["button","submit","reset","file"],_e=We.map(e=>`input:not([type=${e}])`).concat("select","textarea").join(", "),bt=We.map(e=>`input[type=${e}]`).concat("a","button").join(", "),Be=5,xt=500,wt=w(p,se),m=L(c,I),Et=L(m,h),Mt=L(w(h,{pattern:m}),w(h,{selector:c})),$e=w(h,{pattern:m,selector:V(c)}),He=w(h,{pattern:V(m),selector:V(c)}),qe=w(h,{selector:V(c),pickParent:V(c)}),le="|<-REGEXP::FLAGS->|",Tt=w(c,we(le)),St=e=>[e.source,e.flags].join(le),It=e=>new RegExp(...e.split(le)),Zt=(...e)=>JSON.stringify(e,(t,n)=>f(n)(i(I)(St),d(n))),en=e=>JSON.parse(e,(t,n)=>f(n)(i(Tt)(It),d(n))),z=class extends Error{constructor(t,n,{message:o="could not resolve query to any elements"}){let r=u=>`/${u.source}/${u.flags}`,s=(u,y)=>I(y)?r(y):y,a=JSON.stringify(n,s,2);super(`${o}

viddy.${t}(...${a})
`),this.name="ViddyError"}};var k=(...e)=>f(e)(i([m])(fe),i([m,h])(Ft),i([h])(E),d([]));function Ct(e){return(...t)=>f(t)(i([m])(([n])=>E([{selector:e,near:n}])),i([m,qe])(([n,o])=>E([{selector:e,near:M(v({},o),{pattern:n})}])),i([$e])(r=>{var[s]=r,a=s,{pattern:n}=a,o=C(a,["pattern"]);return E([{selector:e,near:M(v({},o),{pattern:n})}])}),i([{selector:c}])(r=>{var[s]=r,a=s,{selector:n}=a,o=C(a,["selector"]);return E([M(v({},o),{selector:n})])}),d([]))}function Pt(e){return(...t)=>Ee(n=>n.filter(re(i(L(N(e)))(!0))))(f(t)(i([m])(([n])=>E([{containedBy:{selector:e},pattern:n}])),i([m,qe])(([n,o])=>E([M(v({},o),{containedBy:{selector:e},pattern:n})])),i([$e])(r=>{var[s]=r,a=s,{pattern:n}=a,o=C(a,["pattern"]);return E([M(v({},o),{containedBy:{selector:e},pattern:n})])}),i([He])(([n])=>E([M(v({},n),{containedBy:{selector:e}})])),i([{selector:c}])(r=>{var[s]=r,a=s,{selector:n}=a,o=C(a,["selector"]);return E([M(v({},o),{selector:n})])}),d(E([{selector:e}]))))}var te=Ct(_e),me=Pt(bt);function fe([e]){let t=f(e)(i(I)(Le),d(je)),n=N(Re).filter(Ce).filter(Pe).filter(t);return n.filter(o=>n.filter(s=>s!==o).every(s=>!o.contains(s)))}function Ft([e,t]){return ee(fe([e]),t)}function E([e]){return f(e)(i({selector:c})(o=>{var r=o,{selector:t}=r,n=C(r,["selector"]);return ee(N(t),n)}),i({pattern:m})(o=>{var r=o,{pattern:t}=r,n=C(r,["pattern"]);return ee(fe([t]),n)}),d(()=>ee(N(Re),e)))}var Nt=e=>v(v({},e),["near","above","below","leftOf","rightOf","containedBy"].reduce((t,n)=>M(v({},t),{[n]:f(e[n])(i(Et)(k),i(p)(o=>k(...o)),d(null))}),{}));function ee(e,t={}){let B=Nt(t),{near:n,containedBy:o,pickParent:r}=B,s=C(B,["near","containedBy","pickParent"]),a=Object.keys(s).length>0,u=ae(Ne),y=ae(Fe),T=({depth:l},b,[g])=>l===g.depth,U=p(o)?l=>{let b=l.map(y),g=x=>$=>$.map((O,H)=>({contained:O.contains(x),depth:H,el:x})).filter(({contained:O})=>O)[0];return x=>b.map(g(x))[0]}:()=>l=>({depth:0,el:l}),J=a?l=>{let{above:b,below:g,leftOf:x,rightOf:$}=Me(l,O=>p(O)?O.map(u):O);return O=>{let H=S=>S.filter(nt=>nt.el!==O),X=u(O),Ye=!p(b)||H(b).every(S=>S.y>X.y),Ze=!p(g)||H(g).every(S=>S.y<X.y),et=!p(x)||H(x).every(S=>S.x>X.x),tt=!p($)||H($).every(S=>S.x<X.x);return Ye&&Ze&&et&&tt}}:()=>()=>!0,Q=p(n)?l=>{let b=l.map(u);return g=>{let x=b.filter(O=>O.el!==g),$=u(g);return x.map(O=>({from:g,distance:ke(O,$)}))[0]}}:()=>l=>({distance:0,from:l}),_=c(r)?l=>{let b=N(l);return g=>y(g).find(x=>b.includes(x))}:()=>R;return e.map(U(o)).filter(Boolean).sort(ie("depth")).filter(T).map(({el:l})=>l).filter(J(s)).map(Q(n)).filter(Boolean).sort(ie("distance")).map(({from:l})=>l).map(_(r)).filter(Boolean)}function Ve(...e){return!!k(...e)[0]}function ze(...e){return k(...e).map(G)}function Ue(...e){return te(...e).map(ce)}function pe(...e){return k(...e).map(t=>t.innerText)}function Je(e,...t){let n=f(t)(i(wt)(()=>[e]),i([p])(([o])=>o),i([m])(([o])=>({pattern:o})),i([He])(([o])=>[M(v({},o),{pattern:e})]),d(()=>t));return pe(...n).map(o=>f(e)(i(I)(r=>{var a;let s=(a=o.match(r))!=null?a:[void 0];return s.length>1||s.groups!==void 0?s:s[0]}),i(c)(o),d(null))).filter(L(c,p))}function de(e="baseWaitFor",t,...n){let o=f(n)(i([{timeoutInMs:q(F)}])(R),i([m,{timeoutInMs:q(F)}])(R),i([m,m,{timeoutInMs:q(F)}])(R),d(Be*1e3)),r=new z(e,n,{message:`timed out after ${o}ms trying to resolve query`});return new Promise((s,a)=>{let u=B=>(s(B),J()),y=()=>(a(r),J()),T=t({done:u,args:n}),U=setTimeout(y,o),J=()=>{clearTimeout(U),_(),Q()},Q=Ae(_e,T),_=ue(T);T()})}function Qe(...e){return de("waitFor",t,...e);function t({args:n,done:o}){return()=>{let r=k(...n);r.length&&o(r.map(G))}}}function Ge(...e){return de("waitForCta",t,...e);function t({args:n,done:o}){return()=>{let r=me(...n);r.length&&o(r.map(G))}}}function Xe(e,...t){if(!t.length)throw new z("waitForValue",t,{message:"no query specified"});return de("waitForValue",n,e,...t);function n({args:o,done:r}){return()=>{let s=te(...o.slice(1)).map(a=>({el:a,value:ce(a)})).filter(({value:a})=>f([e,a])(i([I,c])(([u])=>u.test(a)),i([c,c])(([u])=>u.toLowerCase()===a.toLowerCase()))).map(({el:a})=>a);s.length&&r(s.map(G))}}}var De=L(w(h,{withinMs:F}),w(h,{timeoutInMs:F}),w(h,{withinMs:F,timeoutInMs:F}));function Ke(...e){let t=f(e)(i([q(De)])(R),i([m,q(De)])(R),d({})),{withinMs:n=xt}=t,{timeoutInMs:o=Be*1e3}=t,r=Math.max(o,n+16),s=new z("waitForIdle",e,{message:`timed out after ${r}ms waiting for DOM idle`}),a=f(e)(i([m])(!0),i([Mt])(!0),i([m,h])(!0),d(!1)),u=a&&kt.selectorOf(...e);if(a&&!u)throw new z("waitForIdle",e,{message:"need resolvable query to monitor for DOM idle, or omit query to monitor all DOM changes"});return new Promise((y,T)=>{let U=()=>(y(),l()),Q=setTimeout(()=>(T(s),l()),r),[_,B]=Z(n,U),l=()=>{clearTimeout(Q),B(),b()},b=ue(_,u);_()})}function W(e){return(...t)=>e(...t)[0]}var kt={for:W(k),forCta:W(me),forInput:W(te),selectorOf:W(ze),valueOf:W(Ue),waitFor:(...e)=>Qe(...e).then(t=>t[0]),waitForCta:(...e)=>Ge(...e).then(t=>t[0]),waitForValue:(...e)=>Xe(...e).then(t=>t[0]),waitForIdle:Ke,innerText:W(pe),matchText:W(Je),hasContent:Ve},tn={for:k,forInput:te,forCta:me,selectorOf:ze,valueOf:Ue,waitFor:Qe,waitForCta:Ge,waitForValue:Xe,waitForIdle:Ke,innerText:pe,matchText:Je,hasContent:Ve};export{z as ViddyError,N as qsArray,Zt as serialize,en as unserialize,kt as viddy,tn as viddyWell};
